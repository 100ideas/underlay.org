# Migration `20201029045901-add-schema-description`

This migration has been generated by Joel Gustafson at 10/29/2020, 12:59:01 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."agents.userId_organizationId_unique"

DROP INDEX "public"."agents_organizationId_unique"

DROP INDEX "public"."agents_userId_unique"

ALTER TABLE "public"."agents" DROP CONSTRAINT "agents_organizationId_fkey"

ALTER TABLE "public"."agents" DROP CONSTRAINT "agents_userId_fkey"

ALTER TABLE "public"."agents" DROP COLUMN "userId",
DROP COLUMN "organizationId",
ADD COLUMN "user_id" text   ,
ADD COLUMN "organization_id" text   

ALTER TABLE "public"."collections" ALTER COLUMN "description" SET DEFAULT E''

ALTER TABLE "public"."schemas" ADD COLUMN "description" text   NOT NULL DEFAULT E'',
ADD COLUMN "avatar" text   

CREATE UNIQUE INDEX "agents.user_id_organization_id_unique" ON "public"."agents"("user_id", "organization_id")

CREATE UNIQUE INDEX "agents_user_id_unique" ON "public"."agents"("user_id")

CREATE UNIQUE INDEX "agents_organization_id_unique" ON "public"."agents"("organization_id")

ALTER TABLE "public"."agents" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."agents" ADD FOREIGN KEY ("organization_id")REFERENCES "public"."organizations"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201028182707-init..20201029045901-add-schema-description
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url = "***"
 }
 model Account {
     id                 String    @id @default(uuid())
@@ -83,11 +83,11 @@
 model Agent {
     id String @id @default(uuid())
     user               User?               @relation(fields: [userId], references: [id])
-    userId             String?
+    userId             String?             @map(name: "user_id")
     organization       Organization?       @relation(fields: [organizationId], references: [id])
-    organizationId     String?
+    organizationId     String?             @map(name: "organization_id")
     schemas            Schema[]
     collections        Collection[]
     schemaVersions     SchemaVersion[]
     collectionVersions CollectionVersion[]
@@ -110,8 +110,10 @@
 model Schema {
     id            String               @id @default(uuid())
     slug          String
+    description   String               @default("")
+    avatar        String?
     agentId       String               @map(name: "agent_id")
     agent         Agent                @relation(fields: [agentId], references: [id])
     createdAt     DateTime             @default(now()) @map(name: "created_at")
     updatedAt     DateTime             @default(now()) @updatedAt @map(name: "updated_at")
@@ -123,11 +125,11 @@
 }
 model SchemaVersion {
     id              String              @id @default(uuid())
+    versionNumber   String              @map(name: "version_number")
+    readme          String?
     content         String              @default("") // Raw .toml text
-    readme          String?
-    versionNumber   String              @map(name: "version_number")
     agentId         String              @map(name: "agent_id")
     agent           Agent               @relation(fields: [agentId], references: [id])
     schemaId        String              @map(name: "schema_id")
     schema          Schema              @relation(fields: [schemaId], references: [id])
@@ -152,10 +154,10 @@
 model Collection {
     id            String                   @id @default(uuid())
     slug          String
+    description   String                   @default("")
     avatar        String?
-    description   String
     agentId       String                   @map(name: "agent_id")
     agent         Agent                    @relation(fields: [agentId], references: [id])
     createdAt     DateTime                 @default(now()) @map(name: "created_at")
     updatedAt     DateTime                 @default(now()) @updatedAt @map(name: "updated_at")
```


